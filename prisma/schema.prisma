generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./database.db"
}

model Usuario {
  id                String   @id @default(cuid())
  email             String   @unique
  password          String
  nombre            String
  apellido          String
  dni               String   @unique
  telefono          String?
  rol               String   // ADMIN, COORDINADOR, OPERARIO
  funcion           String   // ADMINISTRATIVO, MEDICO, ENFERMERO, PARAMEDICO, OTROS
  activo            Boolean  @default(true)
  emailVerificado   Boolean  @default(false)
  tokenVerificacion String?
  passwordTemporal  Boolean  @default(true)
  ultimoLogin       DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  trasladosCreados    Traslado[] @relation("UsuarioCreador")
  trasladosAsignados  Traslado[] @relation("UsuarioAsignado")
  procedimientos      Procedimiento[]
  medicaciones        Medicacion[]
  seguimientos        Seguimiento[]
  controlesSignos     ControlSignosVitales[]

  @@map("usuarios")
}

model Hospital {
  id        String   @id @default(cuid())
  nombre    String
  direccion String
  ciudad    String
  provincia String
  telefono  String?
  email     String?
  tipo      String
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trasladosOrigen  Traslado[] @relation("HospitalOrigen")
  trasladosDestino Traslado[] @relation("HospitalDestino")

  @@map("hospitales")
}

model Traslado {
  id                String         @id @default(cuid())
  numeroTraslado    String         @unique
  fechaSolicitud    DateTime       @default(now())
  fechaTraslado     DateTime?
  fechaFinalizacion DateTime?
  
  // Información completa del paciente
  pacienteNombre    String
  pacienteApellido  String
  pacienteDni       String
  pacienteFechaNac  DateTime
  pacienteEdadAnios Int?           // Calculado automáticamente
  pacienteEdadMeses Int?           // Calculado automáticamente
  pacienteEdadDias  Int?           // Calculado automáticamente
  pacienteSexo      String         // MASCULINO, FEMENINO, OTRO
  pacientePeso      Float?
  pacienteAltura    Float?
  pacienteDomicilio String
  pacienteLocalidad String
  tieneCobertura    Boolean        @default(false)
  numeroObraSocial  String?
  
  // Información de la solicitud
  institucionSolicitante String
  profesionalNombre      String
  profesionalCelular     String
  motivoPedido          String
  diagnosticos          String
  codigoTraslado        String      // ROJO, AMARILLO, VERDE
  
  // Información del equipo y aeronave
  horarioSalida         DateTime?
  medicoNombre          String?
  enfermeroNombre       String?
  pilotoNombre          String?
  matriculaAeronave     String?
  
  tipoComplejidad   String
  categoriaPaciente String
  observaciones     String?
  
  estado            String         @default("SOLICITADO")
  prioridad         String         @default("NORMAL")
  
  hospitalOrigenId  String
  hospitalDestinoId String
  usuarioCreadorId  String
  usuarioAsignadoId String?
  
  hospitalOrigen    Hospital @relation("HospitalOrigen", fields: [hospitalOrigenId], references: [id])
  hospitalDestino   Hospital @relation("HospitalDestino", fields: [hospitalDestinoId], references: [id])
  usuarioCreador    Usuario  @relation("UsuarioCreador", fields: [usuarioCreadorId], references: [id])
  usuarioAsignado   Usuario? @relation("UsuarioAsignado", fields: [usuarioAsignadoId], references: [id])
  
  procedimientos    Procedimiento[]
  medicaciones      Medicacion[]
  seguimientos      Seguimiento[]
  controlesSignos   ControlSignosVitales[]
  
  // Campo para epicrisis/debriefing
  epicrisis         String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("traslados")
}

model Procedimiento {
  id          String   @id @default(cuid())
  trasladoId  String
  usuarioId   String
  tipo        String
  descripcion String
  observaciones String?
  fechaHora   DateTime @default(now())
  
  traslado    Traslado @relation(fields: [trasladoId], references: [id], onDelete: Cascade)
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  
  createdAt   DateTime @default(now())

  @@map("procedimientos")
}

model Medicacion {
  id          String   @id @default(cuid())
  trasladoId  String
  usuarioId   String
  medicamento String
  dosis       String
  via         String
  observaciones String?
  fechaHora   DateTime @default(now())
  
  traslado    Traslado @relation(fields: [trasladoId], references: [id], onDelete: Cascade)
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  
  createdAt   DateTime @default(now())

  @@map("medicaciones")
}

model Seguimiento {
  id          String   @id @default(cuid())
  trasladoId  String
  usuarioId   String
  tipo        String
  descripcion String
  observaciones String?
  fechaHora   DateTime @default(now())
  
  traslado    Traslado @relation(fields: [trasladoId], references: [id], onDelete: Cascade)
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  
  createdAt   DateTime @default(now())

  @@map("seguimientos")
}

// Nuevo modelo para controles de signos vitales
model ControlSignosVitales {
  id              String   @id @default(cuid())
  trasladoId      String
  usuarioId       String
  fechaHora       DateTime @default(now())
  
  // Signos vitales
  frecuenciaCardiaca    Int?     // FC - latidos por minuto
  frecuenciaRespiratoria Int?    // FR - respiraciones por minuto
  presionArterialSist   Int?     // TA sistólica
  presionArterialDiast  Int?     // TA diastólica
  temperatura           Float?   // Temperatura en °C
  saturacionO2          Int?     // Saturación de oxígeno %
  escalaGlasgow         Int?     // Score de Glasgow (3-15)
  
  observaciones   String?
  
  traslado        Traslado @relation(fields: [trasladoId], references: [id], onDelete: Cascade)
  usuario         Usuario  @relation(fields: [usuarioId], references: [id])
  
  createdAt       DateTime @default(now())

  @@map("controles_signos_vitales")
}